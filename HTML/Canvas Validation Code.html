<!DOCTYPE html>
<html>
<head>
	<title>Validation Code With Canvas</title>
</head>
<body>
<canvas id="valid-part" width="80" height="30"></canvas>
<input type="text" name="" id="input_code">
<button type="button" onclick="btn_check()">驗證</button>
<script type="text/javascript">
	var vtx='';
	var vtx_all='';
	window.onload=drawCode;

	document.getElementById("valid-part").onclick = function(e){
	e.preventDefault();
	drawCode();
	};

	function RandomCode(){
	vtx='';
	var CodeAll='ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';
	for(var i=0;i<4;i++){
	vtx+=CodeAll[Math.floor(Math.random() * Math.floor(CodeAll.length))];	
	}
	return vtx;
	}

	function RandomCode_One(){
	var CodeAll='ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';
	vtx=CodeAll[Math.floor(Math.random() * Math.floor(CodeAll.length))];
	this.vtx_all+=vtx;
	return vtx;
	}

	function drawCode(){
		vtx_all='';
	var canvas=document.getElementById('valid-part');
	var ctx=canvas.getContext('2d');
	ctx.clearRect(0,0,80,30);
	ctx.fillStyle='rgba(0,0,0,1)';
	ctx.strokeRect(0,0,80,30);
	for(var i=0;i<4;i++){
	drawTxt(ctx,i);
	}
	console.log(this.vtx_all);
	}

	function btn_check(){
	if(document.getElementById('input_code').value.toUpperCase()==this.vtx_all){
	alert('Correct!');
	}
	else{
	alert('Wrong!');
	drawCode();
	}
	}

	function drawTxt(ctx,i){
	ctx.font='italic bold '+getRandomInt(15,28)+'px monospace';
	ctx.textAlign='center';
	ctx.fillStyle ='rgba('+getRandomInt(0,180)+','+getRandomInt(0,180)+','+getRandomInt(0,180)+',1)';
	ctx.fillText(RandomCode_One(),18+i*15,23);
	}

	function getRandomInt(min, max) {
  	min = Math.ceil(min);
  	max = Math.floor(max);
  	return Math.floor(Math.random() * (max - min)) + min; 
	}

</script>
</body>
</html>
